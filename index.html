<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Quality Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 30px;
            border-radius: 8px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .info-box p {
            color: #495057;
            line-height: 1.6;
        }

        .content {
            padding: 40px;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .progress-text {
            color: #6c757d;
            font-size: 14px;
        }

        .question-text {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .question-text p {
            color: #495057;
            line-height: 1.6;
            font-size: 16px;
        }

        .audio-section {
            margin-bottom: 25px;
        }

        .audio-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
            display: block;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        audio {
            width: 100%;
            margin-top: 10px;
            border-radius: 25px;
            outline: none;
        }

        audio::-webkit-media-controls-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-button {
            padding: 20px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
        }

        .option-button:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .option-button.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .secondary-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .secondary-option {
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            color: #6c757d;
        }

        .secondary-option:hover {
            border-color: #6c757d;
            background: #f8f9fa;
        }

        .secondary-option.selected {
            background: #6c757d;
            color: white;
            border-color: #6c757d;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .nav-button {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .prev-button {
            background: #6c757d;
            color: white;
        }

        .prev-button:hover:not(:disabled) {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .next-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .next-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .submit-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .submit-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .completion-message {
            text-align: center;
            padding: 60px 40px;
        }

        .completion-message h2 {
            color: #28a745;
            font-size: 32px;
            margin-bottom: 20px;
        }

        .completion-message p {
            color: #6c757d;
            font-size: 18px;
            line-height: 1.6;
        }

        .results-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }

        .results-box pre {
            background: white;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .download-button {
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .download-button:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .options-grid, .secondary-options {
                grid-template-columns: 1fr;
            }

            .navigation {
                flex-direction: column;
                gap: 10px;
            }

            .nav-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span>üé§</span>
                Voice Quality Evaluation
            </h1>
            <p>Help us evaluate speech synthesis quality</p>
        </div>

        <div class="info-box">
            <h3>üìã Instructions</h3>
            <p>Listen to both audio samples (A and B) and decide which one sounds more <strong>natural and human-like</strong>. Consider overall voice quality, speaking speed, rhythm, and naturalness.</p>
        </div>

        <div class="content" id="content">
            <!-- Questions will be dynamically loaded here -->
        </div>
    </div>

    <script>
        // Sample data embedded directly (no external JSON needed)
        const audioData = [
            {
                id: "sim1",
                text: "Fortunately, there are lots of ways to work around this limitation and use it with whatever operating system you want.",
                audio_a: "audio_others/sim1_a.wav",
                audio_b: "audio_others/sim1_b.wav"
            },
            {
                id: "sim2",
                text: "The municipality consists of the following sub-municipalities: Daverdisse proper, Gembes, Haut-Fays, and Porcheresse.",
                audio_a: "audio_others/sim2_a.wav",
                audio_b: "audio_others/sim2_b.wav"
            },
            {
                id: "sim3",
                text: "Therefore, the first wavelet-based denoising methods were based on thresholding of detail subbands coefficients.",
                audio_a: "audio_others/sim3_a.wav",
                audio_b: "audio_others/sim3_b.wav"
            },
            {
                id: "sim4",
                text: "He greatly enlarged Wagner's original collection by further field collection, purchases and other acquisitions.",
                audio_a: "audio_others/sim4_a.wav",
                audio_b: "audio_others/sim4_b.wav"
            },
            {
                id: "sim5",
                text: "In virtually every organism analyzed, methylation in promoter regions correlates negatively with gene expression.",
                audio_a: "audio_others/sim5_a.wav",
                audio_b: "audio_others/sim5_b.wav"
            },
            {
                id: "sim6",
                text: "Jean-Baptiste Bernadotte fought in Balland's division and Michel Ney was probably in Fromentin's division.",
                audio_a: "audio_others/sim6_a.wav",
                audio_b: "audio_others/sim6_b.wav"
            },
            {
                id: "sim7",
                text: "Yeah, it's definitely worth checking out, especially if the pay is reasonable and the work is good for your career. There was absolutely no reason for her to announce it to the entire company.",
                audio_a: "audio_others/sim7_a.wav",
                audio_b: "audio_others/sim7_b.wav"
            },
            {
                id: "sim8",
                text: "The aircraft had a largely conventional semi-monocoque fuselage, with the engines in underwing nacelles.",
                audio_a: "audio_others/sim8_a.wav",
                audio_b: "audio_others/sim8_b.wav"
            },
            {
                id: "sim9",
                text: "Rockingham-produced earthenware is often transfer printed, but occasionally enamelled pieces may be found.",
                audio_a: "audio_others/sim9_a.wav",
                audio_b: "audio_others/sim9_b.wav"
            },
            {
                id: "sim10",
                text: "At present, the station's satellite coverage reaches Asia, Europe, and Australia in several languages.",
                audio_a: "audio_others/sim10_a.wav",
                audio_b: "audio_others/sim10_b.wav"
            }
        ];

        let currentQuestion = 0;
        let responses = {};

        function renderQuestion() {
            const content = document.getElementById('content');
            
            if (currentQuestion >= audioData.length) {
                showCompletion();
                return;
            }

            const question = audioData[currentQuestion];
            const questionNum = currentQuestion + 1;
            const totalQuestions = audioData.length;

            content.innerHTML = `
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-number">Sample ${questionNum}</div>
                        <div class="progress-text">${questionNum} of ${totalQuestions}</div>
                    </div>

                    <div class="question-text">
                        <p><strong>Text:</strong> ${question.text}</p>
                    </div>

                    <div class="audio-section">
                        <label class="audio-label">Option A:</label>
                        <audio controls preload="auto">
                            <source src="${question.audio_a}" type="audio/wav">
                            Your browser does not support the audio element.
                        </audio>
                    </div>

                    <div class="audio-section">
                        <label class="audio-label">Option B:</label>
                        <audio controls preload="auto">
                            <source src="${question.audio_b}" type="audio/wav">
                            Your browser does not support the audio element.
                        </audio>
                    </div>

                    <div class="options-grid">
                        <button class="option-button" onclick="selectOption('A')" id="option-A">
                            A sounds more natural
                        </button>
                        <button class="option-button" onclick="selectOption('B')" id="option-B">
                            B sounds more natural
                        </button>
                    </div>

                    <div class="navigation">
                        <button class="nav-button prev-button" onclick="previousQuestion()" ${currentQuestion === 0 ? 'disabled' : ''}>
                            ‚Üê Previous
                        </button>
                        <button class="nav-button next-button" onclick="nextQuestion()" id="next-button" disabled>
                            ${currentQuestion === totalQuestions - 1 ? 'Finish' : 'Next ‚Üí'}
                        </button>
                    </div>
                </div>
            `;

            // Restore previous selection if exists
            if (responses[question.id]) {
                selectOption(responses[question.id], false);
            }
        }

        function selectOption(option, enableNext = true) {
            // Remove all selected states
            document.querySelectorAll('.option-button, .secondary-option').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Add selected state to clicked option
            const optionElement = document.getElementById(`option-${option}`);
            if (optionElement) {
                optionElement.classList.add('selected');
            }

            // Store response
            const question = audioData[currentQuestion];
            responses[question.id] = option;

            // Enable next button
            if (enableNext) {
                document.getElementById('next-button').disabled = false;
            }
        }

        function nextQuestion() {
            const question = audioData[currentQuestion];
            if (!responses[question.id]) {
                alert('Please select an option before continuing.');
                return;
            }

            currentQuestion++;
            renderQuestion();
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            }
        }

        function showCompletion() {
            const content = document.getElementById('content');
            
            // Prepare results
            const timestamp = new Date().toISOString();
            const results = {
                _status: 'completed',
                _date: timestamp,
                responses: responses
            };

            const resultsJSON = JSON.stringify(results, null, 2);

            content.innerHTML = `
                <div class="completion-message">
                    <h2>‚è≥ Submitting Results...</h2>
                    <p>Please wait while we save your responses.</p>
                </div>
            `;

            // Submit to Formspree
            submitToFormspree(results);
        }

        function submitToFormspree(results) {
            const formData = new FormData();
            formData.append('status', results._status);
            formData.append('date', results._date);
            formData.append('responses', JSON.stringify(results.responses, null, 2));
            
            // Add individual responses for easier reading in email
            for (const [key, value] of Object.entries(results.responses)) {
                formData.append(key, value);
            }

            fetch('https://formspree.io/f/xvgevpye', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    showSuccessMessage(results);
                } else {
                    showErrorMessage(results);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showErrorMessage(results);
            });
        }

        function showSuccessMessage(results) {
            const content = document.getElementById('content');
            const resultsJSON = JSON.stringify(results, null, 2);

            content.innerHTML = `
                <div class="completion-message">
                    <h2>‚úÖ Evaluation Complete!</h2>
                    <p>Thank you for completing the voice quality evaluation.</p>
                    <p><strong>Your responses have been successfully submitted!</strong></p>

                    <div class="results-box">
                        <h3 style="margin-bottom: 15px; color: #495057;">Your Results:</h3>
                        <pre>${resultsJSON}</pre>
                        <button class="download-button" onclick="downloadResults()">
                            üì• Download Results (JSON)
                        </button>
                        <button class="download-button" onclick="copyResults()" style="margin-left: 10px;">
                            üìã Copy to Clipboard
                        </button>
                    </div>

                    <button class="submit-button" onclick="location.reload()">
                        Start New Evaluation
                    </button>
                </div>
            `;
        }

        function showErrorMessage(results) {
            const content = document.getElementById('content');
            const resultsJSON = JSON.stringify(results, null, 2);

            content.innerHTML = `
                <div class="completion-message">
                    <h2 style="color: #dc3545;">‚ö†Ô∏è Submission Failed</h2>
                    <p>We couldn't submit your responses automatically.</p>
                    <p>Please download your results and send them manually.</p>

                    <div class="results-box">
                        <h3 style="margin-bottom: 15px; color: #495057;">Your Results:</h3>
                        <pre>${resultsJSON}</pre>
                        <button class="download-button" onclick="downloadResults()">
                            üì• Download Results (JSON)
                        </button>
                        <button class="download-button" onclick="copyResults()" style="margin-left: 10px;">
                            üìã Copy to Clipboard
                        </button>
                        <button class="download-button" onclick="retrySubmit()" style="margin-left: 10px; background: #28a745;">
                            üîÑ Retry Submission
                        </button>
                    </div>

                    <button class="submit-button" onclick="location.reload()">
                        Start New Evaluation
                    </button>
                </div>
            `;
        }

        function retrySubmit() {
            const timestamp = new Date().toISOString();
            const results = {
                _status: 'completed',
                _date: timestamp,
                responses: responses
            };
            
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="completion-message">
                    <h2>‚è≥ Retrying Submission...</h2>
                    <p>Please wait while we try again.</p>
                </div>
            `;
            
            submitToFormspree(results);
        }

        function downloadResults() {
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const results = {
                _status: 'completed',
                _date: new Date().toISOString(),
                responses: responses
            };

            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `voice_evaluation_results_${timestamp}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function copyResults() {
            const results = {
                _status: 'completed',
                _date: new Date().toISOString(),
                responses: responses
            };

            navigator.clipboard.writeText(JSON.stringify(results, null, 2))
                .then(() => alert('Results copied to clipboard!'))
                .catch(err => console.error('Failed to copy:', err));
        }

        // Initialize on page load
        renderQuestion();
    </script>
</body>
</html>
